<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Meus Pedidos | XDRONES</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/header.css">
    <link rel="stylesheet" href="assets/css/footer.css">
    <link rel="stylesheet" href="assets/css/cart.css">
    <link rel="stylesheet" href="assets/css/login.css"> 
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* Estilos específicos para a lista de pedidos */
        .pedido-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .pedido-info h3 { margin: 0 0 5px 0; font-size: 1.1rem; color: #333; }
        .pedido-info p { margin: 0; color: #666; font-size: 0.9rem; }
        .pedido-status {
            background: #e6f4ea;
            color: #1e7e34;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        .pedido-total { font-size: 1.2rem; font-weight: bold; color: #0057ff; }
    </style>
</head>
<body>

    <div data-include="components/header.html"></div>

    <main style="padding-top: 120px; min-height: 80vh; background-color: #f9f9f9;">
        <section class="login-container" style="max-width: 800px; margin: 0 auto;">
            
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>Meus Pedidos</h2>
                <a href="perfil.html" class="btn" style="padding: 8px 15px; font-size: 0.9rem;">Voltar ao Perfil</a>
            </div>

            <div id="lista-pedidos">
                <p style="text-align:center; color:#666;">Carregando seus pedidos...</p>
            </div>

        </section>
    </main>

    <div data-include="components/footer.html"></div>

    <script src="assets/js/ui.js"></script>
    <script src="assets/js/cart.js"></script>

    <script>
        // LÓGICA PARA CARREGAR PEDIDOS
        document.addEventListener("DOMContentLoaded", async () => {
            const listaDiv = document.getElementById("lista-pedidos");
            const usuarioId = localStorage.getItem("usuario_id");

            if (!usuarioId) {
                window.location.href = "login.html";
                return;
            }

            try {
                // Chama a API para buscar pedidos deste usuário
                // NOTA: Precisamos criar este endpoint no Backend em breve!
                const response = await fetch(`https://localhost:7155/api/Pedidos/usuario/${usuarioId}`);
                
                if (response.ok) {
                    const pedidos = await response.json();

                    if (pedidos.length === 0) {
                        listaDiv.innerHTML = "<p style='text-align:center'>Você ainda não fez nenhum pedido.</p>";
                        return;
                    }

                    listaDiv.innerHTML = ""; // Limpa o "Carregando..."

                    // Cria um card para cada pedido
                    pedidos.forEach(pedido => {
                        const dataFormatada = new Date(pedido.dataPedido).toLocaleDateString('pt-BR');
                        const totalFormatado = pedido.total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                        listaDiv.innerHTML += `
                            <div class="pedido-card">
                                <div class="pedido-info">
                                    <h3>Pedido #${pedido.id}</h3>
                                    <p>Data: ${dataFormatada}</p>
                                    <p>Pagamento: ${pedido.formaPagamento}</p>
                                </div>
                                <div style="text-align:right;">
                                    <div class="pedido-total">${totalFormatado}</div>
                                    <span class="pedido-status">Aprovado</span>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    listaDiv.innerHTML = "<p style='color:red; text-align:center'>Erro ao carregar pedidos.</p>";
                }
            } catch (error) {
                console.error(error);
                listaDiv.innerHTML = "<p style='text-align:center'>Não foi possível conectar ao servidor.</p>";
            }
        });

        // Loader de componentes
        function loadHTML(selector, url) {
            fetch(url).then(r => r.text()).then(d => document.querySelector(selector).innerHTML = d);
        }
        loadHTML('div[data-include="components/header.html"]', 'components/header.html');
        loadHTML('div[data-include="components/footer.html"]', 'components/footer.html');
    </script>

</body>
</html>